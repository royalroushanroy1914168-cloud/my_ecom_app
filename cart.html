<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cart - My E-commerce App</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f6f7f8; }
    header { background:#2874f0; color:#fff; padding:12px 16px; display:flex; justify-content:space-between; align-items:center; }
    header a { color:#fff; text-decoration:none; font-weight:700; }
    .container { max-width:1000px; margin:20px auto; padding:0 12px; }
    .cart-list { display:grid; gap:12px; }
    .row { background:#fff; border-radius:10px; padding:12px; display:flex; gap:12px; align-items:center; box-shadow:0 1px 4px rgba(0,0,0,0.06); }
    .thumb { width:110px; height:80px; border-radius:8px; object-fit:cover; }
    .meta { flex:1; }
    .meta h4 { margin:0 0 6px; }
    .meta p { margin:0; color:#555; }
    .qty { margin-left:12px; display:flex; gap:6px; align-items:center; }
    .btn { background:#2874f0; color:#fff; padding:8px 12px; border:0; border-radius:6px; cursor:pointer; }
    .btn-light { background:#eee; color:#333; }
    .actions { display:flex; gap:8px; align-items:center; margin-top:12px; }
    .total { text-align:right; font-weight:700; font-size:18px; margin-top:8px; }
    .empty { text-align:center; padding:40px; color:#777; background:#fff; border-radius:10px; }
    @media(max-width:600px){ .row{flex-direction:column; align-items:flex-start;} .thumb{width:100%; height:160px;} .total{text-align:left;} }
  </style>
</head>
<body>
  <header>
    <div><a href="./">← Back</a></div>
    <div>Cart</div>
    <div></div>
  </header>

  <main class="container">
    <h2>Your Cart</h2>
    <div id="cartArea"></div>
  </main>

  <script>
    function getCart(){ return JSON.parse(localStorage.getItem('my_cart') || '[]'); }
    function saveCart(c){ localStorage.setItem('my_cart', JSON.stringify(c)); renderCart(); window.opener?.updateCartCount?.(); }

    function renderCart(){
      const area = document.getElementById('cartArea');
      const cart = getCart();
      if(!cart.length){
        area.innerHTML = '<div class="empty">Your cart is empty.</div>';
        return;
      }

      let html = '<div class="cart-list">';
      cart.forEach((it, idx) => {
        html += `
          <div class="row" data-index="${idx}">
            <img class="thumb" src="${it.img}" alt="${it.title}">
            <div class="meta">
              <h4>${it.title}</h4>
              <p>Price: ₹${it.price.toLocaleString()}</p>
              <div class="qty">
                <button class="btn btn-light" onclick="decrease(${idx})">−</button>
                <span>Qty: <strong id="q${idx}">${it.qty || 1}</strong></span>
                <button class="btn btn-light" onclick="increase(${idx})">+</button>
                <button class="btn" style="margin-left:12px;background:#e74c3c" onclick="removeItem(${idx})">Remove</button>
              </div>
            </div>
            <div style="min-width:120px; text-align:right;">₹${(it.price*(it.qty||1)).toLocaleString()}</div>
          </div>
        `;
      });
      html += `</div>`;

      // Totals + actions
      const total = cart.reduce((s,it)=>s + (it.price*(it.qty||1)), 0);
      html += `<div class="total">Subtotal: ₹${total.toLocaleString()}</div>`;
      html += `<div class="actions"><button class="btn" onclick="checkout()">Checkout</button> <button class="btn btn-light" onclick="clearCart()">Clear cart</button></div>`;

      area.innerHTML = html;
    }

    function increase(i){
      const cart = getCart();
      cart[i].qty = (cart[i].qty || 1) + 1;
      saveCart(cart);
    }
    function decrease(i){
      const cart = getCart();
      cart[i].qty = Math.max(1, (cart[i].qty || 1) - 1);
      saveCart(cart);
    }
    function removeItem(i){
      const cart = getCart();
      cart.splice(i,1);
      saveCart(cart);
    }
    function clearCart(){
      if(!confirm('Clear your cart?')) return;
      saveCart([]);
    }
    function checkout(){
      // simple demo checkout flow
      const cart = getCart();
      if(!cart.length){ alert('Cart empty'); return; }
      // In real app you'd go to payment — here just show a message and clear
      alert('Thanks! Your order is placed (demo).');
      saveCart([]);
    }

    // initial render
    renderCart();

    // keep header cart count updated when returning to index
    function updateCartCount(){
      const cart = getCart();
      const totalQty = cart.reduce((s,it)=>s+(it.qty||1),0);
      // If parent exists (index) try to update its count
      try{ if(window.opener && window.opener.document){ const el = window.opener.document.getElementById('cartCount'); if(el) el.textContent = totalQty; } }catch(e){}
    }
    updateCartCount();
  </script>
</body>
</html>

