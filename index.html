<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My E-commerce App</title>
  <style>
    :root{
      --brand:#2874f0;
      --bg:#f2f2f2;
      --card:#ffffff;
      --muted:#666;
    }
    *{box-sizing:border-box;font-family:Inter,Arial,Helvetica,sans-serif}
    body{margin:0;background:var(--bg);color:#111}
    header{
      background:var(--brand);
      color:#fff;
      padding:18px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      position:sticky;
      top:0;
      z-index:50;
    }
    .brand{font-size:22px;font-weight:700;letter-spacing:0.5px}
    .header-actions{display:flex;align-items:center;gap:16px;position:relative}
    /* Cart Icon */
    .cart-btn{
      background:transparent;border:none;color:#fff;cursor:pointer;position:relative;padding:8px;border-radius:8px;
      display:flex;align-items:center;gap:8px;
    }
    .cart-btn:hover{background:rgba(255,255,255,0.06)}
    .cart-badge{
      position:absolute;
      right:4px;
      top:6px;
      background:#ff3b30;
      color:#fff;
      min-width:20px;height:20px;padding:0 6px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;
      transform-origin:center;
      transition:transform 200ms cubic-bezier(.2,.8,.2,1);
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }
    /* animation class toggled in JS */
    .pulse{ transform: scale(1.25); }

    main{padding:28px 20px 80px; max-width:1100px;margin:0 auto}
    h1{font-size:32px;margin:8px 0 20px}
    .products{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
      gap:18px;
    }
    .card{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:0 2px 6px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
    }
    .card img{width:100%;height:160px;object-fit:cover;border-radius:10px}
    .title{font-weight:700;margin:14px 0 6px;font-size:18px}
    .price{color:var(--muted);margin-bottom:12px}
    .btn{
      background:var(--brand);
      color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;
      font-weight:600;
    }
    .btn:active{transform:translateY(1px)}
    /* Cart dropdown */
    .cart-dropdown{
      position:absolute;
      right:0;
      top:56px;
      width:320px;
      max-height:420px;
      overflow:auto;
      background:#fff;
      color:#111;
      border-radius:10px;
      box-shadow: 0 8px 30px rgba(0,0,0,.12);
      padding:12px;
      display:none;
      z-index:60;
    }
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px}
    .cart-item img{width:56px;height:56px;object-fit:cover;border-radius:6px}
    .cart-item .meta{flex:1}
    .cart-item .meta .name{font-weight:700}
    .cart-item .meta .small{font-size:13px;color:var(--muted)}
    .remove-btn{background:transparent;border:none;color:#ff3b30;font-weight:700;cursor:pointer}
    .cart-footer{border-top:1px solid #eee;padding-top:10px;display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .checkout-btn{background:#00a86b;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    .empty{padding:16px;text-align:center;color:var(--muted)}
    /* responsive */
    @media(max-width:520px){
      header{padding:14px}
      .cart-dropdown{right:8px;left:8px;width:auto}
    }
  </style>
</head>
<body>

<header>
  <div class="brand">My E-commerce App</div>
  <div class="header-actions">
    <button id="cartBtn" class="cart-btn" aria-label="Open cart">
      <!-- simple cart SVG -->
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden>
        <path d="M3 3h2l2 12h11l2-7H7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" />
        <circle cx="10" cy="20" r="1.4" fill="currentColor"></circle>
        <circle cx="18" cy="20" r="1.4" fill="currentColor"></circle>
      </svg>
      <span style="font-weight:600">Cart</span>
      <span id="badge" class="cart-badge" style="display:none">0</span>
    </button>

    <div id="cartDropdown" class="cart-dropdown" aria-hidden="true">
      <div id="cartItems"></div>
      <div id="cartFooter" class="cart-footer"></div>
    </div>
  </div>
</header>

<main>
  <h1>Products</h1>
  <div id="productGrid" class="products"></div>
</main>

<script>
/* ---------- sample products ---------- */
const products = [
  { id:1, title:'Phone A', price:'₹9,999', img:'https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=da9d9d4cea4a4b1d9b66c7b0630a0a31' },
  { id:2, title:'Shoes', price:'₹1,299', img:'https://images.unsplash.com/photo-1534515720779-7416f8793fbf?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=7b8b9f9e3d5f1b8b2b1c9b235b16f0d8' },
  { id:3, title:'Earbuds', price:'₹1,799', img:'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=8d84d5d43b5849b3f1b0d9d3d4f77a12' },
  // add more if you want
];

/* ---------- rendering products ---------- */
const grid = document.getElementById('productGrid');
function renderProducts(){
  grid.innerHTML = '';
  products.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.img}" alt="${p.title}">
      <div class="title">${p.title}</div>
      <div class="price">${p.price}</div>
      <button class="btn" data-id="${p.id}">Add to Cart</button>
    `;
    grid.appendChild(card);
  });

  // attach listeners
  document.querySelectorAll('.btn').forEach(b=>{
    b.addEventListener('click', ()=> addToCart(Number(b.dataset.id)));
  });
}
renderProducts();

/* ---------- cart logic (localStorage) ---------- */
const STORAGE_KEY = 'my_ecom_cart_v1';
function loadCart(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }catch(e){ return []; }
}
function saveCart(cart){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
}

/* ---------- badge update + animation ---------- */
const badge = document.getElementById('badge');
function updateBadge(){
  const cart = loadCart();
  const total = cart.reduce((s,i)=> s + (i.qty||1),0);
  if(total > 0){
    badge.style.display = 'flex';
    badge.textContent = total;
    // pulse animation:
    badge.classList.remove('pulse');
    void badge.offsetWidth; // restart animation
    badge.classList.add('pulse');
    // remove pulse after a short delay
    setTimeout(()=> badge.classList.remove('pulse'), 350);
  } else {
    badge.style.display = 'none';
  }
}

/* ---------- addToCart ---------- */
function addToCart(productId){
  const cart = loadCart();
  const itemIndex = cart.findIndex(i=>i.id===productId);
  if(itemIndex > -1){
    cart[itemIndex].qty = (cart[itemIndex].qty || 1) + 1;
  } else {
    const p = products.find(x => x.id === productId);
    cart.push({ id: p.id, title: p.title, price: p.price, img: p.img, qty: 1 });
  }
  saveCart(cart);
  updateBadge();
  renderCartDropdown(); // live update if open
}

/* ---------- remove item ---------- */
function removeFromCart(productId){
  let cart = loadCart();
  cart = cart.filter(i => i.id !== productId);
  saveCart(cart);
  updateBadge();
  renderCartDropdown();
}

/* ---------- cart dropdown (open/close) ---------- */
const cartBtn = document.getElementById('cartBtn');
const cartDropdown = document.getElementById('cartDropdown');
const cartItemsDiv = document.getElementById('cartItems');
const cartFooter = document.getElementById('cartFooter');

cartBtn.addEventListener('click', (ev)=>{
  ev.stopPropagation();
  const visible = cartDropdown.style.display === 'block';
  if(visible){ cartDropdown.style.display = 'none'; } 
  else { cartDropdown.style.display = 'block'; renderCartDropdown(); }
});

// close when clicking outside
document.addEventListener('click', (ev)=>{
  if(!cartDropdown.contains(ev.target) && ev.target !== cartBtn && !cartBtn.contains(ev.target)){
    cartDropdown.style.display = 'none';
  }
});

/* ---------- render cart listing ---------- */
function renderCartDropdown(){
  const cart = loadCart();
  cartItemsDiv.innerHTML = '';

  if(cart.length === 0){
    cartItemsDiv.innerHTML = '<div class="empty">Your cart is empty</div>';
    cartFooter.innerHTML = '';
    return;
  }

  cart.forEach(item=>{
    const row = document.createElement('div');
    row.className = 'cart-item';
    row.innerHTML = `
      <img src="${item.img}" alt="${item.title}">
      <div class="meta">
        <div class="name">${item.title}</div>
        <div class="small">${item.price} • Qty: ${item.qty}</div>
      </div>
      <button class="remove-btn" data-id="${item.id}">Remove</button>
    `;
    cartItemsDiv.appendChild(row);
  });

  // total & checkout
  const totalItems = cart.reduce((s,i)=> s + (i.qty||1),0);
  // a naive numeric total: remove ₹ and commas to calculate (for demo only)
  const totalAmount = cart.reduce((sum,item)=>{
    const num = Number(item.price.replace(/[^0-9.-]+/g,"")) || 0;
    return sum + num * (item.qty||1);
  },0);

  cartFooter.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div><strong>${totalItems} item(s)</strong><div class="small">Total: ₹${totalAmount.toLocaleString()}</div></div>
      <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
        <button id="clearCartBtn" class="btn" style="background:#ff3b30">Clear</button>
        <button id="checkoutBtn" class="checkout-btn">Checkout</button>
      </div>
    </div>
  `;

  // attach remove listeners
  cartItemsDiv.querySelectorAll('.remove-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> removeFromCart(Number(btn.dataset.id)));
  });
  document.getElementById('clearCartBtn').addEventListener('click', ()=>{
    localStorage.removeItem(STORAGE_KEY);
    updateBadge();
    renderCartDropdown();
  });
  document.getElementById('checkoutBtn').addEventListener('click', ()=>{
    alert('Checkout demo: You can now build a checkout page to collect address and pay.');
  });
}

/* ---------- initialize ---------- */
updateBadge();
</script>

</body>
</html>

<button onclick="window.open('cart.html', '_blank')"
        style="background:#1976d2;color:#fff;padding:10px 16px;border-radius:8px;border:none;">
  Go to Cart
</button>
